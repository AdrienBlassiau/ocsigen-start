<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Module Os_session </title><meta charset="utf8"/><link rel="stylesheet" href="/home/balat/ocsigen/ocsigen.github.io/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js"></script><script src="/home/balat/ocsigen/html_of_wiki/client.js"></script></head><body><h1>Module <span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_session">Os_session</a></span> </h1><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span class="ocsforge_color_uid"><span class="ocsforge_color_uid">Os_session</span></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_session">..</a></span><span class="ocsforge_color_keyword">end</span></pre><p>Connection and disconnection of users,
restrict access to services or server functions,
define actions to be executed at some points of the session.
</p><hr/><pre class="ocsforge_color odocwiki_code" id="VALon_start_process"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">on_start_process</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Call this to add an action to be done on server side
when the process starts</p></div><pre class="ocsforge_color odocwiki_code" id="VALon_start_connected_process"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">on_start_connected_process</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Call this to add an action to be done
when the process starts in connected mode, or when the user logs in</p></div><pre class="ocsforge_color odocwiki_code" id="VALon_connected_request"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">on_connected_request</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Call this to add an action to be done at each connected request.
The function takes the user id as parameter.</p></div><pre class="ocsforge_color odocwiki_code" id="VALon_open_session"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">on_open_session</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Call this to add an action to be done just after opening a session
The function takes the user id as parameter.</p></div><pre class="ocsforge_color odocwiki_code" id="VALon_pre_close_session"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">on_pre_close_session</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Call this to add an action to be done just before closing the session</p></div><pre class="ocsforge_color odocwiki_code" id="VALon_post_close_session"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">on_post_close_session</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Call this to add an action to be done just after closing the session</p></div><pre class="ocsforge_color odocwiki_code" id="VALon_request"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">on_request</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Call this to add an action to be done just before handling a request</p></div><pre class="ocsforge_color odocwiki_code" id="VALon_denied_request"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">on_denied_request</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> option <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Call this to add an action to be done just for each denied request.
The function takes the user id as parameter, if some user is connected.</p></div><pre class="ocsforge_color odocwiki_code" id="VALuser_indep_state_hierarchy"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">user_indep_state_hierarchy</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Eliom_common</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">scope_hierarchy</span></span></pre><div class="odocwiki_info"><p>Scopes that are independant from user connection.
Use this scopes for example when you want to store
server side data for one browser or tab, but not user dependant.
(Remains when user logs out).</p></div><pre class="ocsforge_color odocwiki_code" id="VALuser_indep_process_scope"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">user_indep_process_scope</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Eliom_common</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">client_process_scope</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALuser_indep_session_scope"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">user_indep_session_scope</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Eliom_common</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">session_scope</span></span></pre><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONNot_connected"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Not_connected</span></pre><pre class="ocsforge_color odocwiki_code" id="EXCEPTIONPermission_denied"><span class="ocsforge_color_keyword">exception</span> <span class="odocwiki_name">Permission_denied</span></pre><pre class="ocsforge_color odocwiki_code" id="VALconnect"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">connect</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_label">?expire:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span> <span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Open a session for a user by setting a session group for the browser
which initiated the current request.
Ocsigen-start is using both persistent and volatile session groups.
The volatile groups is recreated from persistent group if absent.
By default, the connection does not expire; by setting the optional
argument <span class="odocwiki_inlinecode">expire</span> to true, the session will expire when the browser
exits.</p></div><pre class="ocsforge_color odocwiki_code" id="VALdisconnect"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">disconnect</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Close a session by discarding server side states for current browser
(session and session group), current client process (tab) and current
request.
Only default Eliom scopes are affected, but not user independant scopes.
The actions registered for session close (by <span class="odocwiki_inlinecode">on_close_session</span>)
will be executed just before the session is actually closed.</p></div><pre class="ocsforge_color odocwiki_code" id="VALconnected_fun"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">connected_fun</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">?allow:</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.Group#TYPEt">Os_types.Group.t</a></span> list <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?deny:</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.Group#TYPEt">Os_types.Group.t</a></span> list <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?deny_fun:</span><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> option <span class="ocsforge_color_delimiter">-&gt;</span> 'c <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_delimiter">-&gt;</span> 'c <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_delimiter">-&gt;</span> 'c <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Wrapper for service handlers that fetches automatically connection
information.
Register <span class="odocwiki_inlinecode">(connected_fun f)</span> as handler for your services,
where <span class="odocwiki_inlinecode">f</span> is a function taking user id, GET parameters and POST parameters.
If no user is connected, the service will fail by raising <span class="odocwiki_inlinecode">Not_connected</span>.
Otherwise it calls function <span class="odocwiki_inlinecode">f</span>.
To provide another behaviour in case the user is not connected,
have a look at <span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_session.Opt#VALconnected_fun">Os_session.​Opt.​connected_fun</a></span> or module <span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_page">Os_page</a></span>.
</p><p>Arguments <span class="odocwiki_inlinecode">?allow</span> and <span class="odocwiki_inlinecode">?deny</span> make possible to restrict access to some
user groups. If access is denied, function <span class="odocwiki_inlinecode">?deny_fun</span> will be called.
By default, it raises <span class="odocwiki_inlinecode">Permission denied</span>.
</p><p>When called on client side, no security check is done.
</p><p>Use only one connection wrapper for each request!</p></div><pre class="ocsforge_color odocwiki_code" id="VALconnected_rpc"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">connected_rpc</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">?allow:</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.Group#TYPEt">Os_types.Group.t</a></span> list <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?deny:</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.Group#TYPEt">Os_types.Group.t</a></span> list <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?deny_fun:</span><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> option <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Wrapper for server functions (see <span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_session#VALconnected_fun">Os_session.​connected_fun</a></span>).</p></div><pre class="ocsforge_color odocwiki_code" id="VALconnected_wrapper"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">connected_wrapper</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">?allow:</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.Group#TYPEt">Os_types.Group.t</a></span> list <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?deny:</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.Group#TYPEt">Os_types.Group.t</a></span> list <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?deny_fun:</span><span class="ocsforge_color_delimiter">(</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_types.User#TYPEid">Os_types.User.id</a></span> option <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_delimiter">(</span>'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Wrapper for server functions when you do not need userid
(see <span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_session#VALconnected_fun">Os_session.​connected_fun</a></span>).
It is recommended to use this wrapper for all your server functions!</p></div><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_session.Opt">Opt</a></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a class="ocsforge_doclink_ocsigen-start" href="/ocsigen-start/1.0/api/server/Os_session.Opt">..</a></span><span class="ocsforge_color_keyword">end</span></pre></body></html>
